<launch>

	<!-- Force ROS_NAMESPACE to be used. -->
	<arg name="ros_ns" default="$(env ROS_NAMESPACE)" />
	<!-- Set the name of the robot. -->
	<arg name="robot" default="lane" />

	<group ns="$(arg robot)">

		<arg name="map" default="/$(arg ros_ns)/map" />
		<arg name="odom" default="$(arg robot)/odom_laser" />
		<arg name="base_frame" default="base_link" />
		<arg name="odom_frame" default="odom_motor" />
		<arg name="map_frame" default="map_hokuyo" />

		<node name="kinematic_sim" pkg="kinematic_sim" type="kinematic_sim" output="screen" respawn="false">
			<param name="agent_prefix" value="$(arg robot)"/>

			<param name="publish_freq" value="10"/>
			<param name="pub_global_frame" value="true"/>

			<param name="base_frame_id" value="$(arg base_frame)"/>
			<param name="odom_frame_id" value="$(arg odom_frame)"/>
			<param name="global_frame_id" value="$(arg map_frame)"/>

			<param name="noise_x_sd" value="0.0"/>
			<param name="noise_y_sd" value="0.0"/>
			<param name="noise_th_sd" value="0.0"/>

			<param name="num_agents" value="1"/>

			<param name="initial0" value="0.00 0.00 0.00"/>
			<param name="$(arg robot)0" value="$(arg ros_ns)/$(arg robot)"/>

			<!-- <remap from="/$(arg robot)/odom_motor" to="$(arg robot)/odom_motor" />
			<remap from="/$(arg robot)/amcl_pose" to="$(arg robot)/amcl_pose" />
			<remap from="/$(arg robot)/gt_pose" to="$(arg robot)/gt_pose" />
			<remap from="/$(arg robot)/gt_odom" to="$(arg robot)/gt_odom" />
			<remap from="/$(arg robot)/cmd_vel" to="$(arg robot)/cmd_vel" />
			<remap from="/$(arg robot)/initialpose" to="$(arg robot)/initialpose" /> -->

			<!-- <remap from="/$(arg robot)/odom_motor" to="odom_motor" />
			<remap from="/$(arg robot)/amcl_pose" to="amcl_pose" />
			<remap from="/$(arg robot)/gt_pose" to="gt_pose" />
			<remap from="/$(arg robot)/gt_odom" to="gt_odom" />
			<remap from="/$(arg robot)/cmd_vel" to="cmd_vel" />
			<remap from="/$(arg robot)/initialpose" to="initialpose" /> -->
		</node>

		<node name="laser" pkg="laser_simulator" type="laser_simulator" output="screen" respawn="false">
			<param name="frame_id" value="/$(arg ros_ns)/$(arg robot)/$(arg base_frame)"/>
			<param name="offset/x" value="0.0"/>
			<param name="offset/y" value="0.0"/>
			<param name="offset/z" value="0.2"/>

			<param name="noise_sd" value="0.003"/>

			<rosparam file="$(find laser_simulator)/models/UTM_30.yaml" command="load" />
			<rosparam file="$(find laser_simulator)/config/models.yaml" command="load" />

			<remap from="~map" to="$(arg map)"/>
			<remap from="~odom" to="gt_odom"/>
			<remap from="~scan" to="scan" />
			<remap from="/diagnostics" to="laser_diagnostics" />
		</node>

		<node name="pose" pkg="hfn" type="tf_posestamped_node.py">
			<param name="base_frame_id" value="/$(arg ros_ns)/$(arg robot)/$(arg base_frame)"/>
			<param name="map_frame_id" value="$(arg map_frame)"/>
		</node>

		<node name="hfn" pkg="hfn" type="hfn">
			<param name="base_frame_id" value="/$(arg ros_ns)/$(arg robot)/$(arg base_frame)" />
			<param name="map_frame_id" value="$(arg map_frame)" />

			<param name="tau_1" value="1.0" />
			<param name="tau_2" value="0.2" />
			<!-- old and good -->
			<!-- <param name="tau_1" value="1.5" /> -->
			<!-- <param name="tau_2" value="0.3" /> -->
			<param name="cost_occ_prob" value="0.01" />
			<param name="cost_occ_dist" value="0.15" />
			<param name="max_occ_dist" value="0.5" />
			<param name="lethal_occ_dist" value="0.35" />

			<param name="v_opt" value="0.5" />
			<param name="w_max" value="1.0" />
			<!-- 0.0873 rad ~= 5 degrees -->
			<!-- <param name="goal_tolerance_ang" value="0.0873" /> -->
			<param name="goal_tolerance_ang" value="0.2" />
			<param name="min_map_update" value="2.0" />
			<param name="stuck_start" value="3.0" />
			<remap from="odom" to="$(arg odom_frame)" />
			<remap from="map" to="$(arg map)" />
			<param name="stop_on_preempt" value="false" />
			<remap from="cmd_vel" to="cmd_vel" />
		</node>

		<node name="goal_to_action" pkg="hfn" type="goal_to_action.py" />

	</group>

</launch>